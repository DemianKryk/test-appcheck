# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Build
on:
  workflow_dispatch:
    branches: [master]
concurrency:
  group: build-$
  cancel-in-progress: true

permissions:
  id-token: write # This is required for requesting the JWT
  contents: read # This is required for actions/checkout
jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4.1.5
      - uses: subosito/flutter-action@v2.12.0
        with:
          channel: "stable"
          cache: true
          cache-key: "flutter-:os:-:channel:-:version:-:arch:-:hash:" # optional, change this to force refresh cache
          cache-path: "${{ runner.tool_cache }}/flutter/:channel:-:version:-:arch:" # optional, change this to specify the cache path
          architecture: x64 # optional, x64 or arm64
          flutter-version: ${{ secrets.FLUTTER_FRAMEWORK_VERSION }}
      - run: flutter config --no-analytics
      - run: flutter config --no-cli-animations
      - name: Flutter Pub Get # get flutter packages information
        run: flutter pub get
      # - name: Flutter Pub Get # get flutter packages information
      #   run: flutter pub get
      - name: Build the Web static pages # generate deployment files
        run: |
          flutter build web --release --wasm
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_TEST_APPCHECK_EF87E }}
          channelId: live
          projectId: test-appcheck-ef87e
